
      
        <div class="panel panel-default">

            <div class="panel-heading">
                <h4>{LABEL}</h4>
            </div>
            <div class="panel-body">
            	<form role="form" method="post" action="admin_pagamento-action" id="frmPagamento" class="form">
                    <input type="hidden" name="acao" id="acao" value="outros"/>
                    <input type="hidden" name="itens" id="itens" value=""/>
                    
                    <fieldset>
                        <legend>
                            forma de Pagamento
                        </legend>
                        <div class="form-group">
                            <label for="tipoPagamento"><i class='fa'> </i><b>Selecione</b></label>
                            <div class="row">
                                <!-- BEGIN BLOCK_TIPO_PAG -->
                                <div class="col-xs-2 col-md-2 text-center">
                                    <div class="thumbnail">
                                        <img src="img/credit/{IMG_PAG}" class="img-responsive" alt="{NOME_PAG}">
                                        <input type="radio" class="form-control required" value="{ID_PAG}" name="tipoPagamento" {CHECKED}/>
                                        {NOME_PAG}
                                    </div>
                                </div>
                                <!-- END BLOCK_TIPO_PAG -->
                            </div>
                        </div>
                    </fieldset>
                
                <fieldset>
                    <legend>
                        Pagamento
                    </legend>
                    <div class="row">
                        <div class="col-md-8 col-xs-8">
                            <div class="form-group">
                                <label for="descricao"><i class='fa'> </i><b>Descrição</b></label>
                                <input type="text" class="form-control required" name="descricao" id="descricao" />
                            </div>
                        </div>
                        <div class="col-md-4 col-xs-4">
                            <div class="form-group">
                                <label for="data"><i class='fa'> </i><b>Data de Vencimento</b></label>
                                
                                    <input type="text" class="form-control required" name="data" id="data" />
                                
                            </div>
                        </div>
                    </div>
                    
                </fieldset>
                 <fieldset>
                    <legend>
                        Sacado
                    </legend>
                    <div class="row">
                        <div class="col-md-8 col-xs-8">
                            <div class="form-group">
                                <label for="nomeSacado"><i class='fa'> </i><b>Nome</b></label>
                                <input type="text" class="form-control required" name="nomeSacado" id="nomeSacado" />
                            </div>
                        </div>
                        <div class="col-md-4 col-xs-4">
                            <div class="form-group">
                                <label for="cpfSacado"><i class='fa'> </i><b>CPF/CNPJ</b></label>                                
                                    <input type="text" class="form-control required" name="cpfcnpj" id="cpfcnpj" />                                
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-8 col-xs-8">
                            <div class="form-group">
                                <label for="endereco"><i class='fa'> </i><b>Endereço</b></label>
                                <input type="text" class="form-control required" name="endereco" id="endereco" />
                            </div>
                        </div>
                        <div class="col-md-4 col-xs-4">
                            <div class="form-group">
                                <label for="bairro"><i class='fa'> </i><b>Bairro</b></label>
                                
                                    <input type="text" class="form-control required" name="bairro" id="bairro" />
                                
                            </div>
                        </div>
                    </div>
                    <div class="row">
                <div class="col-md-3 col-xs-3">
                    <div class="form-group">
                        <label for="uf"><i class='fa'> </i><b>Estado</b></label>
                         <select name="uf" id="uf" class="required form-control">
                            <option value="">Selecione</option>
                            <!-- BEGIN BLOCK_UF -->
                            <option value="{id_uf}" {selectedUf}>{uf}</option>
                            <!-- END BLOCK_UF -->
                        </select>
                    </div>
                </div>
                <div class="col-md-6 col-xs-6">
                    <div class="form-group">
                        <label for="cidade"><i class='fa'> </i><b>Cidade</b></label>
                        <select name="cidade" id="cidade" class="required form-control">
                            <option value="">Selecione</option>
                            <!-- BEGIN BLOCK_CIDADE -->
                            <option value="{id_cidade}" {selectedCidade}>{nome_cidade}</option>
                            <!-- END BLOCK_CIDADE -->
                        </select>
                    </div>
                </div>
                <div class="col-md-3 col-xs-3">
                            <div class="form-group">
                                <label for="telefone"><i class='fa'> </i><b>Telefone</b></label>
                                
                                    <input type="text" class="form-control required" name="telefone" id="telefone" />
                                
                            </div>
                        </div>
            </div>
                    </fieldset>
               </form> 
                <fieldset>
                    <legend>
                        Adicionar Itens 
                    </legend>
                    
                    <div class="panel panel-success">
                        <form role="form" method="post" action="#" id="frmItem" name="frmItem">
                            
                            <div class="panel-body">

                                <div class="row">
                                    <div class="col-md-12 col-xs-12">
                                        <div class="form-group">
                                            <label for="descricao"><i class='fa'> </i><b>Descrição</b></label>
                                            <input type="text" name="descricaoItem" id="descricaoItem" class="form-control required"/>
                                        </div>
                                    </div>                                   
                                </div>
                                <div class="row">
                                    <div class="col-md-12 col-xs-12">
                                        <div class="form-group">
                                            <label for="documento"><i class='fa'> </i><b>Custa</b></label>
                                            <select id="custa" name="custa" class="form-control required">
                                                <option value="">Selecione</option>
                                                <!-- BEGIN BLOCK_CUSTA -->
                                                <option value="{ID_CUSTA}" valor="{VALOR}">{LABEL_CUSTA}</option>
                                                <!-- END BLOCK_CUSTA -->
                                            </select>
                                        </div>
                                    </div>                                    
                                </div>

                            </div>
                            <div class="panel-footer">
                                <button type="button" class="btn btn-success" id="btAdicionar">
                                    Adicionar
                                </button>
                            </div>
                        </form>
                    </div>
                    <table class="table table-condensed table-striped" id="tblList"></table>
                    <div class="row">
                        <div class="col-md-8 text-right">Total:</div>
                        <div class="col-md-4 text-right">
                            <input type="text" disabled="disabled" class="form-control disabled text-right" name="total" id="total" value="R$ 0,00"/>
                        </div>

                    </div>
                    
                </fieldset>
                
            </div>
            <div class="panel-footer text-right">
                <button class="btn btn-default btVoltar" type="button">
                    <span class="glyphicon glyphicon-backward"> </span> Voltar
                </button>
                <button class="btn btn-primary" type="button" id="btAvancar">
                    Concluir <span class="glyphicon glyphicon-forward"> </span>
                </button>

            </div>

        </div>


<script src="js/plugins/bsnAutoSuggest/bsn.AutoSuggest_2.1.3_comp.js"></script>
<link href="css/bsnAutoSuggest/autosuggest_inquisitor.css" rel="stylesheet" type="text/css" />
<script>
	function somatotal() {
		var total = 0;
		for (var i in itens) {
			var atl = JSON.parse(itens[i]);
			total = total + eval(parseFloat(atl.valor));
		}
		$("#total").val("R$ " + (total.format(2, 3, '.', ',')));

	}

	var itens = [];
	var selected_index = -1;
	function LimpaCampos() {
		$("#descricaoItem").val("");
		$("#custa").val("");		

	}

	function AddItem() {
		var item = JSON.stringify({
		    descricao : $("#descricaoItem").val(),
			custa : $("#custa").val(),
			nomecusta : $("#custa").find('option:selected').text(),
			valor: $("#custa").find('option:selected').attr("valor"),
		});
		itens.push(item);
	}

	function Delete() {
		itens.splice(selected_index, 1);

	}

	function List() {
		$("#tblList").html("");
		$("#tblList").html("<thead>" + "   <tr>" + "   <th></th>" + "   <th>Descrição</th>" + "   <th>Custa</th>" + "   </tr>" + "</thead>" + "<tbody>" + "</tbody>");
		for (var i in itens) {
			var atl = JSON.parse(itens[i]);
			$("#tblList tbody").append("<tr>" + "  <td><button type='button' alt='Delete" + i + "' class='btnDelete btn btn-danger'><span class='glyphicon glyphicon-trash'> </span></button> </td>" + "  <td>" + atl.descricao + "</td>" + "  <td>" + atl.nomecusta + "</td>" + "</tr>");
		}
	}


	$(document).on('click', '.btnDelete', function() {
		selected_index = parseInt($(this).attr("alt").replace("Delete", ""));
		Delete();
		List();
		somatotal();
	});
	
	function cidadePorUf(){
         $.ajax({
                url : "ajax/cidadesPorUf.php",
                type : "POST",
                async:false,
                data : {uf: $("#uf").val()},                
            }).done(function(msg) {
                $("#cidade").html(msg);
            });
    }

	$(document).ready(function() {
        var options = {
			script : "ajax/json_pessoasbynome.php?",
			varname : "busca",
			json : true,
			noresults : "Nenhuma pessoa encontrado",
			maxresults : 35,
			callback : function(obj) {
				var atleta;
				$.ajax({
					url : 'ajax/json_pessoa.php',
					data : {
						id : obj.id
					}
				}).done(function(retorno) {
					atleta = JSON.parse(retorno);
					document.getElementById("nomeSacado").value = atleta.nome+" "+atleta.nomeMeio+" "+atleta.sobrenome;
					document.getElementById("cpfcnpj").value =  atleta.cpf; 			
                    document.getElementById("endereco").value =  atleta.endereco; 
                    document.getElementById("bairro").value =  atleta.bairro; 
                    document.getElementById("telefone").value =  atleta.telResidencial; 
                    document.getElementById("uf").value = atleta.cidade.uf.id;
                    $.ajax({
                url : "ajax/cidadesPorUf.php",
                type : "POST",
                data : {uf:atleta.cidade.uf.id},                
            }).done(function(msg) {
                $("#cidade").html(msg);
                document.getElementById("cidade").value = atleta.cidade.id;
            });
                });
                

			}
		};
		var as = new bsn.AutoSuggest('nomeSacado', options);





        $('#data').datepicker();
		$("#cpfcnpj").inputmask({ mask: ["999.999.999-99","99.999.999/9999-99"]});
        $("#telefone").inputmask({ mask: ["99 9999-9999","99 99999-9999"]});
        $("#uf").change(function(){
            $.ajax({
                url : "ajax/cidadesPorUf.php",
                type : "POST",
                data : {uf: $(this).val()},                
            }).done(function(msg) {
                $("#cidade").html(msg);
            });

        });
        
        
		$("#valor").inputmask({
			alias : "decimal",
			groupSeparator : ".",
			autoGroup : true,
			digits : 2,
			digitsOptional : false,
			prefix : "",
			placeholder : ""
		});
		

		

		$("#btAdicionar").click(function() {
			if ($("#frmItem").valid()) {
				AddItem();
				List();
				LimpaCampos();
				somatotal();
			}
		});

		$("#btAvancar").click(function() {
			if (itens.length > 0) {
				if (confirm("Confirma a inclusão do pagamento?")) {
					var strjson = "[";
					for (var i in itens) {
						var atl = JSON.parse(itens[i]);
						strjson = strjson + JSON.stringify(atl) + ',';
					}
					strjson = strjson + ']';
					$("#itens").val(strjson);
					if($("#frmPagamento").valid())
					   $("#frmPagamento").submit();
				}
			} else {
				alert("Você deve adicionar um ou mais itens!");
			}

		});

		$("#frmItem").validate({
			errorClass : "help-inline",
			errorElement : "div",
			highlight : function(element, errorClass, validClass) {
				$(element).parents('.form-group').addClass('has-error');
				$(element).parents('.form-group').children("label").children("i").addClass("fa-times-circle-o");
			},
			unhighlight : function(element, errorClass, validClass) {
				$(element).parents('.form-group').removeClass('has-error');
				$(element).parents('.form-group').addClass('has-success');
				$(element).parents('.form-group').children("label").children("i").removeClass("fa-times-circle-o");
				$(element).parents('.form-group').children("label").children("i").addClass("fa-check");
			},
			
		});
		
		$("#frmPagamento").validate({
			errorClass : "help-inline",
			errorElement : "div",
			highlight : function(element, errorClass, validClass) {
				$(element).parents('.form-group').addClass('has-error');
				$(element).parents('.form-group').children("label").children("i").addClass("fa-times-circle-o");
			},
			unhighlight : function(element, errorClass, validClass) {
				$(element).parents('.form-group').removeClass('has-error');
				$(element).parents('.form-group').addClass('has-success');
				$(element).parents('.form-group').children("label").children("i").removeClass("fa-times-circle-o");
				$(element).parents('.form-group').children("label").children("i").addClass("fa-check");
			},
			
		});

	});

</script>